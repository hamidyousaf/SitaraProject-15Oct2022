@model Numbers.Entity.ViewModels.GRGRNViewModel

@{
    ViewData["Title"] = "Create Greige Good Receipt Note";
    var companyName = Context.Session.GetString("CompanyName");
    var companyId = Context.Session.GetInt32("CompanyId").Value;
}
@section customCSS{ 
<style>
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>
}

<div class="row">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            @*<div class="ibox-title">
                    <h5> Greige Quality</h5>
                    <span class="label label-success pull-right status"></span>
                </div>*@
            <div class="ibox-content ibox-content-1">
                <form method="post" onsubmit="return OnSubmit();" asp-controller="GRN" asp-action="Create">
                    <div class="row">
                        <input hidden asp-for="GRGRN.Id" />
                        <div class="col-lg-2 col-sm-4">
                            <div class="form-group">
                                <label class="col-form-label" asp-for="GRGRN.TransactionNo"></label>
                                @if (Model.GRGRN.Id != 0)
                                {
                                    <input readonly class="form-control" id="TransactionNo" data-validation="required" asp-for="GRGRN.TransactionNo" autocomplete="off" tabindex="-1" />
                                }
                                else
                                {
                                    <input readonly class="form-control" id="TransactionNo" data-validation="required" value="" autocomplete="off" tabindex="-1" />}
                            </div>
                        </div>
                        <div class="col-lg-2 col-sm-4">
                            <div class="form-group">
                                <label asp-for="GRGRN.TransactionDate"></label>
                                <div class="input-group" readonly>
                                    <span class="input-group-addon" readonly><i class="fa fa-calendar"></i></span>
                                    <input tabindex="-1" id="ContractDate" autofocus class="form-control" asp-for="GRGRN.TransactionDate" type="text" readonly value="@CommonHelper.CurrentDate" />
                                </div>
                            </div>
                        </div>
                
                            <div class="col-lg-2">
                                <div class="form-group">
                                    <label class="col-form-label">Folding #<i style="color: #a94442;">*</i></label>
                                    <select asp-items="@Model.FeederLov" asp-for="GRGRN.FoldingId" name="GRGRN.FoldingId" class="chosen-select form-control" id="FoldingId">
                                        <option value="0">Please select</option>
                                    </select>
                                </div>
                            </div>
                    

                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label" asp-for="GRGRN.WeavingContractId"></label>
                                <select tabindex="-1" asp-for="GRGRN.WeavingContractId" class="chosen-select form-control" id="WeavingContractId">
                                    <option value="0">Please select</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label" asp-for="GRGRN.PurchaseContractId"></label>
                                <select tabindex="-1" asp-for="GRGRN.PurchaseContractId" class="chosen-select form-control" id="PurchaseContractId">
                                    <option value="0">Please select</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-3">
                            <div class="form-group">
                                <label class="col-form-label">Vendor</label>
                                <input type="text" asp-for="GRGRN.VendorId" tabindex="-1" id="VendorId" hidden readonly class="form-control text-left hidden" />
                                <input type="text" asp-for="GRGRN.VendorName" tabindex="-1" id="VendorName" readonly class="form-control text-left" />
                            </div>
                        </div>
                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label" asp-for="GRGRN.ContractRate"></label>
                                <input asp-for="GRGRN.ContractRate" readonly tabindex="-1" id="ContractRate"  class="form-control text-left" />
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="ibox-title">
                            <h2 style="font-weight:bold;">Greige Quality </h2>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                <label class="col-form-label">Contract Greige Quality</label>
                                <input type="text" asp-for="GRGRN.GreigeContractQuality" tabindex="-1" id="GreigeQualityId" readonly class="form-control text-left" />
                            </div>
                        </div>
                        <div class="col-lg-3">
                            <div class="form-group">
                                <label class="col-form-label">On Loom Greige Quality</label>
                                <input type="text" asp-for="GRGRN.GreigeContractQualityLoom" tabindex="-1" id="LoomQualityId" readonly class="form-control text-left" />
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="ibox-title">
                            <h2 style="font-weight:bold;">Greige Information</h2>
                        </div>
                        <div class="col-md-1">
                            <div class="form-group">
                                <label class="control-label">Ends</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.End" min="0" step="1" id="End" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="form-group">
                                <label class="control-label">Picks</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.Picks" min="0" step="1" id="Picks" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Width</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.Width" min="0" step="1" id="Width" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Woven Pieces</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.WovenPieces" min="0" step="1" id="WomenPieces" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Woven Qty</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.WovenQty" min="0" step="1" id="WovenQty" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Mended Pieces</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.MendedPieces" min="0" step="1" id="MendedPieces" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Mended Qty</label>
                                <input type="number"readonly tabindex="-1" asp-for="GRGRN.MendedQty" min="0" step="1" id="MendedQty" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Folded Pieces</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.FoldedPieces" min="0" step="1" id="FoldedPieces" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Folded Qty</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.FoldedQty" min="0" step="1" id="FoldedQty" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Rejected Qty</label>
                                <input type="number" readonly tabindex="-1" asp-for="GRGRN.RejectedQty" min="0" step="1" id="RejectedQty" class="form-control text-right" />
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="ibox-title">
                            <h2 style="font-weight:bold;">Penalty</h2>
                        </div>

                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label"> Penalty<i style="color: #a94442;">*</i></label>
                                <select class="chosen-select form-control" id="PenaltyId" asp-items="@Model.Penalty">
                                    <option value="0">Please select</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-2 hidden">
                            <div class="form-group">
                                <label class="control-label">Penalty Rate<i style="color: #a94442;">*</i></label>
                                <input type="number" min="0" step="1" id="Rate" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Defect Qty<i style="color: #a94442;">*</i></label>
                                <input type="number" min="0" step="1" id="Qty" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="form-group col-lg-1 " style="margin-left:5px">
                            <label class="control-label">  </label>
                            <div>
                                <input type="button" class="btn btn-primary" onclick="addRow();" style="margin-top:4px" value="Add" />
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12">
                            <div class="container-fluid table-responsive">
                                <table id="table" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th hidden>Id</th>
                                            <th>Penalty</th>
                                            <th>Sample</th>
                                            <th>Defect Qty</th>
                                            <th>Actual Width<span style="color: white;">*</span></th>
                                            <th>Actual Pick<span style="color: white;">*</span></th>
                                            <th>Penalty Rate</th>
                                            <th>Amount</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.GRGRNItem != null)
                                        {
                                            @for (int i = 0; i < Model.GRGRNItem.Length; i++)
                                            {

                                        <tr class="removed">
                                            @*<td hidden ><input class="Id" name="name" value="@Model.GRGRNItem[i].Id" /> </td>
        <td hidden ><input class="SrNo" value="@Model.GRGRNItem[i].PenaltyId" /></td>
        <td ><input class="PenaltyName text-center"  name="name" value="@Model.GRGRNItem[i].Penalty.ConfigValue" /></td>
        <td ><input class="Sample text-right " name="name" value="@Model.GRGRNItem[i].Sample" /></td>
        <td ><input class="DefectQty text-right" name="name" value="@Model.GRGRNItem[i].Quantity" /></td>
        <td ><input class="ActualWidth text-right "  value="@Model.GRGRNItem[i].ActualWidth" /></td>
        <td ><input class="ActualPick text-right "  value="@Model.GRGRNItem[i].ActualPick" /></td>
        <td ><input class="PenaltyRate text-right "  value="@Model.GRGRNItem[i].PenaltyRate" /></td>
        <td ><input class="Amount text-right"  value="@Model.GRGRNItem[i].Amount" /></td>
        <td class="text-center"><a class="btn btn-danger"><i class="fas fa-trash remove-row"></i></a></td>*@
                                            <td hidden class="Id">@Model.GRGRNItem[i].Id</td>
                                            <td hidden class="SrNo">@Model.GRGRNItem[i].PenaltyId</td>
                                            <td class="PenaltyName text-left">@Model.GRGRNItem[i].Penalty.ConfigValue</td>
                                            <td class="Sample text-right ">@Model.GRGRNItem[i].Sample</td>
                                            <td class="DefectQty text-right">@Model.GRGRNItem[i].Quantity</td>
                                            <td><input readonly class="form-control ActualWidth text-right " value="@Model.GRGRNItem[i].ActualWidth" /></td>
                                            <td><input readonly class="form-control ActualPick text-right " value="@Model.GRGRNItem[i].ActualPick" /></td>
                                            <td class="PenaltyRate text-right ">@Model.GRGRNItem[i].PenaltyRate</td>
                                            <td class="Amount text-right">@Model.GRGRNItem[i].Amount</td>
                                            <td class="text-center"><a class="btn btn-danger"><i class="fas fa-trash remove-row"></i></a></td>
                                        </tr>
                                            }
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr style='font-weight: bold'>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td class='text-right '>Total:</td>
                                            <td class='text-right TotalAmount'>0</td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-------------------------------Stacking Area---------------------------------------->
                    <div class="row">
                        <div class="ibox-title">
                            <h2 style="font-weight:bold;">Stacking</h2>
                        </div>

                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label"> WareHouse<i style="color: #a94442;">*</i></label>
                                <select class="chosen-select form-control" id="WareHouseId" asp-items="@Model.WareHouse">
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="col-form-label"> Location<i style="color: #a94442;">*</i></label>
                                <select class="chosen-select form-control" id="LocationId" asp-items="@Model.Location">
                                    <option value="0">Please select</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">Quantity<i style="color: #a94442;">*</i></label>
                                <input type="number" min="0" step="1" id="Qty2" class="form-control text-right" />
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label class="control-label">BalQty</label>
                                <input type="number" min="0" step="1" tabindex="-1" id="balQty2" class="form-control text-right" readonly />
                            </div>
                        </div>
                        <div class="form-group col-lg-1" style="margin-left:5px">
                            <label class="control-label">  </label>
                            <div>
                                <input type="button" class="btn btn-primary" onclick="addRow2();" style="margin-top:4px" value="Add" />
                            </div>
                        </div>

                        <div class="col-lg-12 col-sm-12">
                            <div class="container-fluid table-responsive">
                                <table id="tableSt" class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th hidden>Id</th>
                                            <th>WareHouse</th>
                                            <th>Location</th>
                                            <th>Quantity</th>
                                            <th>Bal Qty</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @if (Model.GRStackingItem != null)
                                        {
                                            @for (int i = 0; i < Model.GRStackingItem.Length; i++)
                                            {

                                                <tr class="removed">
                                                    <td hidden class="Id">@Model.GRStackingItem[i].Id</td>
                                                    <td hidden class="WareHouseId">@Model.GRStackingItem[i].WareHouseId</td>
                                                    <td class="PenaltyName text-left">@Model.GRStackingItem[i].WareHouse.ConfigValue</td>
                                                    <td hidden class="LocationId text-right ">@Model.GRStackingItem[i].LocationId</td>
                                                    <td class="LocationName text-left ">@Model.GRStackingItem[i].Location.ConfigValue</td>
                                                    <td class="Qty2 text-right">@Model.GRStackingItem[i].Quantity</td>
                                                    <td class="BalQty2 text-right">@Model.GRStackingItem[i].BalQty</td>
                                                    <td class="text-center"><a class="btn btn-danger"><i class="fas fa-trash remove-row"></i></a></td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr style='font-weight: bold'>
                                            <td></td>
                                            <td class='text-right'>Total:</td>
                                            <td class='text-right TotalMeasure'>0</td>
                                            <td class='text-right TotalActual'>0</td>
                                            <td></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                    <!----------------------------------------------------------------------->
                    <div class="row">
                        <div class="col-lg-2">
                            <br />
                            <a asp-controller="GRN" asp-action="Index" class="btn btn-white">List</a>
                            <button class="btn btn-primary" type="submit" id="SaveBtn">Save</button>
                            <input type="hidden" id="SaveBtnFocus" value="OFF" />
                        </div>
                    </div>
                    <input hidden id="itemDetail" name="ItemDetail" />
                    <input hidden id="itemStack" name="itemStack" />
                </form>
            </div>
        </div>
    </div>
</div>
@section customJS{
    <script>
    $(document).ready(function () {
        $("#FoldingId").select2();
        $("#WeavingContractId").select2();
        $("#PurchaseContractId").select2();

        $("#PenaltyId").select2();
        $("#WareHouseId").select2();
        $("#LocationId").select2();
        //$("#GreigeQualityId").select2();
        //$("#LoomQualityId").select2();
        //$("#VendorId").select2();
        //Get Weaving Contract

        //Get Purchase Contract

        RowCalculation();
        RowCalculation2();
        if (@Model.GRGRN.Id != 0) {
            debugger;
            getFoldingData();

        }

    });

    function getWeavingContract() {
        debugger
        $('#Address').val("");
        $('#GreigeQualityId').val("");
        $('#LoomQualityId').val("");
        $('#Quantity').val("");
        $('#BalanceQuantity').val("");
        $('#PurchaseContractId').val(0).trigger('change.select2');
        var weavingContractId = $('#WeavingContractId').val();
        $.ajax({
            type: "GET",
            url: "/Greige/GRN/GetWeavingContract",
            data: { Id: weavingContractId }
        }).done(function (data) {
            debugger
            if (data != null) {
                $('#VendorId').val(data.vendor.id == "" ? "Not Define" : data.vendor.id);
                $('#VendorName').val(data.vendor.name == "" ? "Not Define" : data.vendor.name);
                $('#GreigeQualityId').val(data.greigeQuality.description);
                $('#LoomQualityId').val(data.greigeQualityLoom.description);
                $('#Quantity').val(data.contractQty);
                $('#BalanceQuantity').val(data.contractQty);
                $('#CheckBalanceQuantity').val(data.contractQty);
                $('#End').val(data.greigeQualityLoom.grConstruction.reed);
                $('#Picks').val(data.greigeQualityLoom.grConstruction.pick);
                $('#Width').val(data.greigeQualityLoom.width);
                $('#ContractRate').val((data.valueOfGreige / 40).toFixed(2));
                return false;
            } else {
                $('#Address').val("Non Avaiable");
                return false;
            }
        });
    }
                function getPurchaseContract() {
                    debugger
                    $('#Address').val("");
                    $('#GreigeQualityId').val("");
                    $('#LoomQualityId').val("");
                    $('#Quantity').val("");
                    $('#BalanceQuantity').val("");
                    $('#WeavingContractId').val(0).trigger('change.select2');
                    var purchaseContractId = $('#PurchaseContractId').val();
                    $.ajax({
                        type: "GET",
                        url: "/Greige/GRN/GetPurchaseContract",
                        data: { Id: purchaseContractId }
                    }).done(function (data) {
                        debugger
                        if (data != null) {
                            $('#VendorId').val(data.vendor.id == "" ? "Not Define" : data.vendor.id);
                            $('#VendorName').val(data.vendor.name == "" ? "Not Define" : data.vendor.name);
                            $('#GreigeQualityId').val(data.contractGRQuality.description);
                            $('#LoomQualityId').val(data.purchaseGRQuality.description);
                            $('#Quantity').val(data.contractQuantity);
                            $('#BalanceQuantity').val(data.contractQuantity);
                            $('#CheckBalanceQuantity').val(data.contractQuantity);
                            $('#End').val(data.contractGRQuality.grConstruction.pick);
                            $('#Picks').val(data.contractGRQuality.grConstruction.pick);
                            $('#Width').val(data.contractGRQuality.width);
                            $('#ContractRate').val(data.ratePerMeter);
                            return false;
                        } else {
                            $('#Address').val("Non Avaiable");
                            return false;
                        }
                    });
                };
    $("#FoldingId").change(function () {
        debugger

        var foldingId = $('#FoldingId').val();
        $.ajax({
            type: "GET",
            url: "/Greige/GRN/GetFolding",
            data: { Id: foldingId }
        }).done(function (data) {
            debugger
            if (data != null) {

                $('#WomenPieces').val(data.data.wovenPieces);
                $('#WovenQty').val(data.data.wovenQty);
                $('#MendedPieces').val(data.data.mendingPieces);
                $('#MendedQty').val(data.data.mendingQuantity);
                $('#FoldedPieces').val(data.data.foldPieces);
                $('#FoldedQty').val(data.data.foldQty);
                $('#balQty2').val(data.data.foldQty);
                $('#RejectedQty').val(data.data.totalRejectedQuantity);
                if (data.purchaseContract.length != 0) {
                    $('#PurchaseContractId').find('option').remove();
                    $('#WeavingContractId').find('option').remove();
                    $.each(data.purchaseContract, function (i, item) {
                        debugger;
                        $('#PurchaseContractId').append($('<option>', {

                            value: item.value,
                            text: item.text
                        }));
                    });
                    getPurchaseContract();
                    return true;
                }
                if (data.weavingContract.length != 0) {
                    $('#WeavingContractId').find('option').remove();
                    $('#PurchaseContractId').find('option').remove();
                    $.each(data.weavingContract, function (i, item) {
                        debugger
                        $('#WeavingContractId').append($('<option>', {

                            value: item.value,
                            text: item.text
                        }));
                    });
                    getWeavingContract();
                    //return true;
                }
                return true;
            } else {
                $('#Address').val("Non Avaiable");
                return false;
            }
        });
    });

    function getFoldingData() {

        debugger

        var foldingId = $('#FoldingId').val();
        $.ajax({
            type: "GET",
            url: "/Greige/GRN/GetFolding",
            data: { Id: foldingId }
        }).done(function (data) {
            debugger
            if (data != null) {
                $('#WomenPieces').val(data.data.wovenPieces);
                $('#WovenQty').val(data.data.wovenQty);
                $('#MendedPieces').val(data.data.mendingPieces);
                $('#MendedQty').val(data.data.mendingQuantity);
                $('#FoldedPieces').val(data.data.foldPieces);
                $('#FoldedQty').val(data.data.foldQty);
                $('#balQty2').val(data.data.foldQty);
                $('#RejectedQty').val(data.data.totalRejectedQuantity);
                if (data.purchaseContract.length != 0) {
                    $('#PurchaseContractId').find('option').remove();
                    $('#WeavingContractId').find('option').remove();
                    $.each(data.purchaseContract, function (i, item) {
                        debugger;
                        $('#PurchaseContractId').append($('<option>', {

                            value: item.value,
                            text: item.text
                        }));
                    });
                    getPurchaseContract();
                    return true;
                }
                if (data.weavingContract.length != 0) {
                    $('#WeavingContractId').find('option').remove();
                    $('#PurchaseContractId').find('option').remove();
                    $.each(data.weavingContract, function (i, item) {
                        debugger
                        $('#WeavingContractId').append($('<option>', {

                            value: item.value,
                            text: item.text
                        }));
                    });

                    //return true;
                }
                return true;
            } else {
                $('#Address').val("Non Avaiable");
                return false;
            }
        });
    }

    //On change Greige Quality on Loom
    $('#GreigeQualityLoomId').on('change', function () {
        debugger
        var vendorId = $('#GreigeQualityLoomId').val();
        $.ajax({
            type: "GET",
            url: "/Greige/Api/GetGreigeConstruction",
            data: { qualityId: vendorId }
        }).done(function (data) {
            debugger
            if (data.grConstruction != null) {
                debugger;
                $('#Picks').val(data.grConstruction.pick);
                $('#Reed').val(data.grConstruction.reed);
                $('#Width').val(data.width);
                $('#Weft').val(data.grConstruction.weft.name);
                $('#Warp').val(data.grConstruction.warp.name);
                $('#WarpCount').val(data.grConstruction.warp.name.substring(0, data.grConstruction.warp.name.indexOf("-")));
                $('#WeftCount').val(data.grConstruction.weft.name.substring(0, data.grConstruction.weft.name.indexOf("-")));
                weftWeight();
                warpWeight();
            }
        });

    })


    function addRow() {
        debugger;

        var weavingContractId = $("#WeavingContractId").find(":selected").val();
      //  if (weavingContractId != 0) {

            var penaltyId = $("#PenaltyId").find(":selected").val();
            var penaltyName = $("#PenaltyId").find(":selected").text();
            var defectQty = Number($("#Qty").val());
            var sample = 5;
            var actualWidth = 0.0;
            var actualpick = 0;
            var PenaltyRate = 0;
            var amount = 0;
            var rateBind = false;
            if (penaltyId == 0 && penaltyId == 0) {
                swal({
                    icon: "warning",
                    text: "Please select penalty!",
                    closeModal: false
                }).then(function () {
                    swal.close();
                    $("#PenaltyId").focus();
                });
                return false;
            }
            else if (defectQty == 0 || defectQty == "") {
                swal({
                    icon: "warning",
                    text: "Please enter quantity!",
                    closeModal: false
                }).then(function () {
                    swal.close();
                    $("#Qty").focus();
                });
                return false;
            }

            if (defectQty != 0) {

                var weavingContractId = $('#WeavingContractId').val();
                var PurchaseContractId = $('#PurchaseContractId').val();
                var foldedQty = Number($("#FoldedQty").val());
                if (weavingContractId != 0 && weavingContractId != undefined) {

                    $.ajax({
                        type: "GET",
                        url: "/Greige/GRN/GetWeavingContract",
                        data: { Id: weavingContractId }
                    }).done(function (data) {
                        debugger
                        if (data != null) {
                            debugger;
                            var totalMeterInLot = Number(foldedQty);
                          /*  var totalMeterInLot = Number(data.contractQty);*/
                            var valueOfGreigethFromTotalMeter = Number((totalMeterInLot / 400) * defectQty).toFixed(2);
                            PenaltyRate = Number(data.valueOfGreige).toFixed(2);
                            if (penaltyName == "Less Length") {
                                debugger;
                                PenaltyRate = (Number(data.valueOfGreige) / 40).toFixed(2);
                                amount = Number(valueOfGreigethFromTotalMeter * PenaltyRate).toFixed(2);
                                actualWidth = 0;
                                actualpick = 0;
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                //row += '<td class ="ActualWidth text-right" onchange="CalculateRow($(this));" >' + actualWidth + '</td>';
                                //row += '<td class ="ActualPick text-right"  onchange="CalculateRow($(this));" >' + actualpick + '</td>';
                                row += '<td class ="PenaltyRate text-right">' + PenaltyRate + '</td>';
                                row += '<td class ="Amount text-right">' + amount + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';
                                $('#table tbody').append(row);
                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            } else if (penaltyName == "Short Width") {
                                debugger;
                                PenaltyRate = (Number(data.valueOfGreige) / 40).toFixed(2);
                                amount = Number(valueOfGreigethFromTotalMeter * PenaltyRate).toFixed(2);
                                actualWidth = 0;
                                actualpick = 0;
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td  style=' width: 150px; ' > <input  value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                //row += '<td class ="ActualWidth text-right" onchange="CalculateRow($(this));" >' + actualWidth + '</td>';
                                //row += '<td class ="ActualPick text-right"  onchange="CalculateRow($(this));" >' + actualpick + '</td>';
                                row += '<td class ="PenaltyRate text-right">' + 0 + '</td>';
                                row += '<td class ="Amount text-right">' + 0 + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';
                                $('#table tbody').append(row);
                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            }
                            else if (penaltyName == "Short Pick") {
                                debugger;
                                var actualReed = 0;
                                var actualPick = 0;
                                requiredPick = Number(data.greigeQualityLoom.grConstruction.pick);
                                requiredReed = Number(data.greigeQualityLoom.grConstruction.reed);
                                var requiredThread = Number(requiredReed + requiredPick);
                                var actualThread = Number(actualReed + actualPick);
                                var valueOfGreige = Number(data.valueOfGreige).toFixed(2);
                                var Rate = Number(valueOfGreige - ((actualThread / requiredThread) * valueOfGreige)).toFixed(2);
                                var qty = Number((Number(totalMeterInLot) / sample) * 1);
                                //$(row).closest("tr").find(".PenaltyRate").val(Rate)
                                //$(row).closest("tr").find(".Amount").val(amount);
                                for (var i = 1; i <= defectQty; i++) {
                                    amount = Number(Rate * qty).toFixed(2);
                                    var row = '';
                                    row += '<tr>';
                                    row += '<td hidden class ="Id">0</td>';
                                    row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                    row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                    row += '<td class ="Sample text-right">' + 5 + '</td>';
                                    row += '<td readonly class ="DefectQty text-right">' + 1 + '</td>';
                                    row += "<td  style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                    row += "<td  style=' width: 150px; ' > <input value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                    row += '<td class ="PenaltyRate text-right">' + 0 + '</td>';
                                    row += '<td class ="Amount text-right">' + 0 + '</td>';
                                    row += '<td class="text-center">';
                                    row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                    row += '</tr>';

                                    $('#table tbody').append(row);

                                    //clearTextBox();
                                    //CalculateAmount
                                    RowCalculation();

                                }

                            }
                            else {
                                // PenaltyRate=
                                amount = Number(PenaltyRate * qty).toFixed(2);
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                row += '<td class ="PenaltyRate text-right">' + PenaltyRate + '</td>';
                                row += '<td class ="Amount text-right">' + amount + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';

                                $('#table tbody').append(row);

                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            }

                            //$('#BalanceQuantity').val(data.contractQty);
                            //$('#CheckBalanceQuantity').val(data.contractQty);
                            //$('#End').val(data.greigeQualityLoom.grConstruction.reed);
                            //$('#Picks').val(data.greigeQualityLoom.grConstruction.pick);
                            //$('#Width').val(data.greigeQualityLoom.width);
                            //$('#ContractRate').val(data.valueOfGreige);
                            return false;
                        }
                    });
                    $("#PenaltyId").focus();

                }
                else if (PurchaseContractId != 0 && PurchaseContractId != undefined)
                {
                    debugger;
                    $.ajax({
                        type: "GET",
                        url: "/Greige/GRN/GetPurchaseContract",
                        data: { Id: PurchaseContractId }
                    }).done(function (data) {
                        debugger
                        if (data != null) {
                            debugger;
                            var totalMeterInLot = Number(foldedQty);
                          /*  var totalMeterInLot = Number(data.contractQuantity);*/
                            var valueOfGreigethFromTotalMeter = Number((totalMeterInLot / 400) * defectQty).toFixed(2);
                            PenaltyRate = Number(data.ratePerMeter).toFixed(2);
                            if (penaltyName == "Less Length") {
                                debugger;
                                PenaltyRate = (Number(data.ratePerMeter)).toFixed(2);
                                amount = Number(valueOfGreigethFromTotalMeter * PenaltyRate).toFixed(2);
                                actualWidth = 0;
                                actualpick = 0;
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                //row += '<td class ="ActualWidth text-right" onchange="CalculateRow($(this));" >' + actualWidth + '</td>';
                                //row += '<td class ="ActualPick text-right"  onchange="CalculateRow($(this));" >' + actualpick + '</td>';
                                row += '<td class ="PenaltyRate text-right">' + PenaltyRate + '</td>';
                                row += '<td class ="Amount text-right">' + amount + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';
                                $('#table tbody').append(row);
                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            } else if (penaltyName == "Short Width") {
                                debugger;
                                PenaltyRate = (Number(data.ratePerMeter)).toFixed(2);
                                amount = Number(valueOfGreigethFromTotalMeter * PenaltyRate).toFixed(2);
                                actualWidth = 0;
                                actualpick = 0;
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td  style=' width: 150px; ' > <input  value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                //row += '<td class ="ActualWidth text-right" onchange="CalculateRow($(this));" >' + actualWidth + '</td>';
                                //row += '<td class ="ActualPick text-right"  onchange="CalculateRow($(this));" >' + actualpick + '</td>';
                                row += '<td class ="PenaltyRate text-right">' + 0 + '</td>';
                                row += '<td class ="Amount text-right">' + 0 + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';
                                $('#table tbody').append(row);
                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            }
                            else if (penaltyName == "Short Pick") {
                                debugger;
                                var actualReed = 0;
                                var actualPick = 0;
                                requiredPick = Number(data.contractGRQuality.grConstruction.pick);
                                requiredReed = Number(data.contractGRQuality.grConstruction.reed);
                                var requiredThread = Number(requiredReed + requiredPick);
                                var actualThread = Number(actualReed + actualPick);
                                var valueOfGreige = Number(data.ratePerMeter).toFixed(2);
                                var Rate = Number(valueOfGreige - ((actualThread / requiredThread) * valueOfGreige)).toFixed(2);
                                var qty = Number((Number(totalMeterInLot) / sample) * 1);
                                //$(row).closest("tr").find(".PenaltyRate").val(Rate)
                                //$(row).closest("tr").find(".Amount").val(amount);
                                for (var i = 1; i <= defectQty; i++) {
                                    amount = Number(Rate * qty).toFixed(2);
                                    var row = '';
                                    row += '<tr>';
                                    row += '<td hidden class ="Id">0</td>';
                                    row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                    row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                    row += '<td class ="Sample text-right">' + 5 + '</td>';
                                    row += '<td readonly class ="DefectQty text-right">' + 1 + '</td>';
                                    row += "<td  style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                    row += "<td  style=' width: 150px; ' > <input value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                    row += '<td class ="PenaltyRate text-right">' + 0 + '</td>';
                                    row += '<td class ="Amount text-right">' + 0 + '</td>';
                                    row += '<td class="text-center">';
                                    row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                    row += '</tr>';

                                    $('#table tbody').append(row);

                                    //clearTextBox();
                                    //CalculateAmount
                                    RowCalculation();

                                }

                            }
                            else {
                                // PenaltyRate=
                                amount = Number(PenaltyRate * totalMeterInLot).toFixed(2);
                                var row = '';
                                row += '<tr>';
                                row += '<td hidden class ="Id">0</td>';
                                row += '<td hidden class ="SrNo text-center">' + penaltyId + '</td>';
                                row += '<td class ="PenaltyName text-left">' + penaltyName + '</td>';
                                row += '<td class ="Sample text-right">' + 5 + '</td>';
                                row += '<td readonly class ="DefectQty text-right">' + defectQty + '</td>';
                                row += "<td style=' width: 150px; ' > <input readonly value=" + actualWidth + " name='ActualWidth' id='ActualWidth' onchange='CalculateRow($(this));'   class='form-control text-right ActualWidth '  /></td>";
                                row += "<td  style=' width: 150px; ' > <input readonly value=" + actualpick + " name='ActualPick' id='ActualPick' onchange='CalculateRow($(this));'   class='form-control text-right ActualPick '  /></td>";
                                row += '<td class ="PenaltyRate text-right">' + PenaltyRate + '</td>';
                                row += '<td class ="Amount text-right">' + amount + '</td>';
                                row += '<td class="text-center">';
                                row += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
                                row += '</tr>';

                                $('#table tbody').append(row);

                                //clearTextBox();
                                //CalculateAmount
                                RowCalculation();
                            }

                            //$('#BalanceQuantity').val(data.contractQty);
                            //$('#CheckBalanceQuantity').val(data.contractQty);
                            //$('#End').val(data.greigeQualityLoom.grConstruction.reed);
                            //$('#Picks').val(data.greigeQualityLoom.grConstruction.pick);
                            //$('#Width').val(data.greigeQualityLoom.width);
                            //$('#ContractRate').val(data.valueOfGreige);
                            return false;
                        }
                    });

                }


            }

       // }
    }




    function CalculateRow(row) {

        debugger
        var penaltyName = $(row).closest("tr").find(".PenaltyName").html();
        var sample = Number( $(row).closest("tr").find(".Sample").html());
        var defectQty = Number( $(row).closest("tr").find(".DefectQty").html());
        var actualWidth = Number( $(row).closest("tr").find(".ActualWidth").val());
        var actualPick = Number( $(row).closest("tr").find(".ActualPick").val());
        var requiredwidth = 0
        var requiredReed = 0
        var requiredPick = 0

        var weavingContractId = $("#WeavingContractId").find(":selected").val();
        var PurchaseContractId = $("#PurchaseContractId").find(":selected").val();
        if (weavingContractId != 0 && weavingContractId != undefined) {

            var penaltyId = $("#PenaltyId").find(":selected").val();
            //var penaltyName = $("#PenaltyId").find(":selected").text();
            //var defectQty = Number($("#Qty").val());
            var foldedQty = Number($("#FoldedQty").val());
            var actualReed = 0;
            var PenaltyRate = 0;
            var amount = 0;
            var rateBind = false;

            $.ajax({
                data: { Id: weavingContractId },

                    type: "GET",
                    url: "/Greige/GRN/GetWeavingContract",
                }).done(function (data) {
                    debugger
                    if (data != null) {
                        debugger;
                        var totalMeterInLot = Number(foldedQty);
                        var valueOfGreigethFromTotalMeter = Number((totalMeterInLot / 400) * defectQty).toFixed(2);
                        PenaltyRate = Number(data.valueOfGreige).toFixed(2);
                        requiredReed = Number(data.greigeQualityLoom.grConstruction.reed);
                        requiredPick = Number(data.greigeQualityLoom.grConstruction.pick);
                        actualReed = Number(data.greigeQualityLoom.grConstruction.reed);
                        requiredwidth = Number(data.greigeQualityLoom.width);
                        var valueOfGreige = Number(Number(data.valueOfGreige).toFixed(2) / 40).toFixed(2);
                        if (penaltyName == "Short Pick") {
                            debugger;
                            defectQty =1
                            var requiredThread = Number(requiredReed + requiredPick);
                            var actualThread = Number(actualReed + actualPick);
                            /*  var valueOfGreige = Number(data.valueOfGreige).toFixed(2);*/
                            var Rate = Number(valueOfGreige - ((actualThread / requiredThread) * valueOfGreige)).toFixed(2);
                            var qty = Number((Number(totalMeterInLot) / sample) * defectQty);
                            amount = Number(Rate * qty).toFixed(2);

                            $(row).closest("tr").find(".PenaltyRate").html(Rate)
                            $(row).closest("tr").find(".Amount").html(amount);

                            RowCalculation();
                        } else if (penaltyName == "Short Width") {
                            debugger;
                            requiredReed = Number(data.greigeQualityLoom.grConstruction.width);
                          /*  var valueOfGreige = Number(data.valueOfGreige).toFixed(2);*/
                            var Rate = Number(valueOfGreige - ((actualWidth / requiredwidth) * valueOfGreige)).toFixed(2);

                            var qty = Number((Number(totalMeterInLot) / sample) * defectQty);
                            amount = Number(Rate * qty).toFixed(2);

                            $(row).closest("tr").find(".PenaltyRate").html(Rate)
                            $(row).closest("tr").find(".Amount").html(amount);

                            RowCalculation();
                        }

                        return false;
                    }
                });

        }
        else if (PurchaseContractId != 0 && PurchaseContractId != undefined) {
            debugger;
            var penaltyId = $("#PenaltyId").find(":selected").val();
            //var penaltyName = $("#PenaltyId").find(":selected").text();
            //var defectQty = Number($("#Qty").val());
            var foldedQty = Number($("#FoldedQty").val());
            var actualReed = 0;
            var PenaltyRate = 0;
            var amount = 0;
            var rateBind = false;

            $.ajax({
                data: { Id: PurchaseContractId },

                type: "GET",
                url: "/Greige/GRN/GetPurchaseContract",
            }).done(function (data) {
                debugger
                if (data != null) {
                    debugger;
                    var totalMeterInLot = Number(foldedQty);
                    var valueOfGreigethFromTotalMeter = Number((totalMeterInLot / 400) * defectQty).toFixed(2);
                    PenaltyRate = Number(data.ratePerMeter).toFixed(2);
                    requiredReed = Number(data.contractGRQuality.grConstruction.reed);
                    requiredPick = Number(data.contractGRQuality.grConstruction.pick);
                    actualReed = Number(data.contractGRQuality.grConstruction.reed);
                    requiredwidth = Number(data.contractGRQuality.width);
                    //var valueOfGreige = Number(Number(data.valueOfGreige).toFixed(2) / 40).toFixed(2);
                    var valueOfGreige = Number(data.ratePerMeter).toFixed(2);
                    if (penaltyName == "Short Pick") {
                        debugger;
                        defectQty = 1
                        var requiredThread = Number(requiredReed + requiredPick);
                        var actualThread = Number(actualReed + actualPick);
                        //var valueOfGreige = Number(data.ratePerMeter).toFixed(2);
                        var Rate = Number(valueOfGreige - ((actualThread / requiredThread) * valueOfGreige)).toFixed(2);
                        var qty = Number((Number(totalMeterInLot) / sample) * defectQty);
                        amount = Number(Rate * qty).toFixed(2);

                        $(row).closest("tr").find(".PenaltyRate").html(Rate)
                        $(row).closest("tr").find(".Amount").html(amount);

                        RowCalculation();
                    } else if (penaltyName == "Short Width") {
                        debugger;
                        requiredReed = Number(data.contractGRQuality.grConstruction.width);
                       // var valueOfGreige = Number(data.ratePerMeter).toFixed(2);
                        var Rate = Number(valueOfGreige - ((actualWidth / requiredwidth) * valueOfGreige)).toFixed(2);

                        var qty = Number((Number(totalMeterInLot) / sample) * defectQty);
                        amount = Number(Rate * qty).toFixed(2);

                        $(row).closest("tr").find(".PenaltyRate").html(Rate)
                        $(row).closest("tr").find(".Amount").html(amount);

                        RowCalculation();
                    }

                    return false;
                }
            });

        }



    }

    function clearTextBox() {
        $("#Qty").val("");
    }

    function CalculateAmount() {
        debugger;
       var rate = Number( $("#Rate").val());
        var qty = Number($("#Qty").val());
        var amount = rate * qty;

            $("#Amount").val(amount);
    }




    function RowCalculation() {
        debugger
        var actual = Number( 0.0);
        var checkBalanceQuantity = Number($("#CheckBalanceQuantity").val());
        $('#table > tbody > tr').each(function () {
            debugger;

            var TotalActual = Number($(this).find(".Amount").text());

            actual = actual + TotalActual;
        });

        $('#table > tfoot > tr').find(".TotalAmount").text(Number(actual).toFixed(2));
        $("#BalanceQuantity").val(checkBalanceQuantity - actual)
    }
    function deleterow(row) {
        debugger
        var actual = Number(row.closest("tr").find(".Actual").text());
        var balanceQuantity = Number($("#BalanceQuantity").val());
        $("#BalanceQuantity").val(balanceQuantity + actual);
        row.closest("tr").remove();
        RowCalculation();
    }


    $("#table tbody").on("click", ".remove-row", function () {
        debugger;
        $(this).closest("tr").remove();
        RowCalculation();

    });


    function OnSubmit() {
        debugger;
        var itemDetails = [];
        var itemStacking = [];
        var foldingId = $('#FoldingId').val();
        var weavingContractId = $('#WeavingContractId').val();
        var purchaseContractId = $('#PurchaseContractId').val();
        if (foldingId == null || foldingId == 0) {
            swal({
                icon: 'warning',
                text: "Select Folding # ..!",
                closeModal: false
            }).then(function () {
                swal.close();
                $('#FoldingId').focus();
            });
            return false;
        }
        if ((weavingContractId == null || weavingContractId == 0) && (purchaseContractId == null || purchaseContractId == 0) ) {
            swal({
                icon: 'warning',
                text: "Select Weaving/Purchase Contract # ..!",
                closeModal: false
            }).then(function () {
                swal.close();

            });
            return false;
        }
        //if (purchaseContractId == null || purchaseContractId == 0) {
        //    swal({
        //        icon: 'warning',
        //        text: "Select Purchase Contract # ..!",
        //        closeModal: false
        //    }).then(function () {
        //        swal.close();
        //        $('#PurchaseContractId').focus();
        //    });
        //    return false;
        //}
        
            $.each($("#table tbody tr"), function () {
                itemDetails.push({
                    Id: $(this).find('.Id').html(),
                    PenaltyId: $(this).find('.SrNo').html(),
                    PenaltyRate: $(this).find('.PenaltyRate').html(),
                    Quantity: $(this).find('.DefectQty').html(),
                    Amount: $(this).find('.Amount').html(),
                    ActualWidth: $(this).find('.ActualWidth').val(),
                    ActualPick: $(this).find('.ActualPick').val(),
                    Sample: $(this).find('.Sample').html(),
                });

            });
    




        /////////// Stacking
        $.each($("#tableSt tbody tr"), function () {
            itemStacking.push({
                Id: $(this).find('.Id').html(),
                WareHouseId: $(this).find('.WareHouseId').html(),
                LocationId: $(this).find('.LocationId').html(),
                Quantity: $(this).find('.Qty2').html(),
                BalQty: $(this).find('.BalQty2').html(),
            });

        });
        var model = JSON.stringify(itemStacking);
        $("#itemStack").val(model);
        ////////// End Stacking


        var model = JSON.stringify(itemDetails);
        $("#itemDetail").val(model);
        if (itemDetails.length <= 0) {

            swal({
                icon: 'warning',
                text: "Enter At Least One Penalty Item!",
                closeModal: false
            }).then(function () {
                swal.close();
                $('#PenaltyId').focus();
            });
            return false;
        }
        if (itemStacking.length <= 0) {

            swal({
                icon: 'warning',
                text: "Enter At Least One Stacking Item!",
                closeModal: false
            }).then(function () {
                swal.close();
                $('#WareHouseId').focus();
            });
            return false;
        }
        $("#SaveBtn").attr("disabled", true);
        $("#SaveBtn").text("Saving...");
        return true;
    }

    /////////////////////////// Stacking Table Jquery ////////////////

    //$('#Qty2').on('change', function () {
    //    debugger
    //    var Qty2 = Number($('#Qty2').val());
    //    var balQty = Number($("#balQty2").val());
    //    if (Qty2 > balQty ) {
    //        swal({
    //            icon: "warning",
    //            text: "Qty cannot be Greater than Balance Qty!",
    //            closeModal: false
    //        })
    //        return false;
    //    }
    //})
    var BalanceQty222 = Number($("#balQty2").val());
    function addRow2() {
        debugger;

        var penaltyId = $("#WareHouseId").find(":selected").val();
        var penaltyName = $("#WareHouseId").find(":selected").text();
        var locationId = $("#LocationId").find(":selected").val();
        var locationName = $("#LocationId").find(":selected").text();
        var balQty = Number($("#balQty2").val());
        var qty = Number($("#Qty2").val());
        var srNo = penaltyId;

        if (penaltyId == 0 && penaltyId == 0) {
            swal({
                icon: "warning",
                text: "Please select penalty!",
                closeModal: false
            }).then(function () {
                swal.close();
                $("#PenaltyId").focus();
            });
            return false;
        }
        if (locationId == 0 && locationId == 0) {
            swal({
                icon: "warning",
                text: "Please select Location!",
                closeModal: false
            }).then(function () {
                swal.close();
                $("#LocationId").focus();
            });
            return false;
        }
        if (balQty <= 0 || balQty == "" ) {
            swal({
                icon: "warning",
                text: "Balance Qty cannot be 0!",
                closeModal: false
            })
            return false;
        }
        if (balQty <= 0 || balQty == "") {
            swal({
                icon: "warning",
                text: "Balance Qty cannot be 0!",
                closeModal: false
            })
            return false;
        }
        if (qty > balQty) {
            swal({
                icon: "warning",
                text: "Qty cannot be Greater than Balance Qty!",
                closeModal: false
            }).then(function () {
                swal.close();
                $("#Qty").focus();
            });
            return false;
        }

        var length = $("#tableSt > tbody > tr").length;
        if (length != 0) {
            debugger
            var sr = Number($('#tableSt > tbody > tr:last').find(".SrNo").text());
            srNo = srNo + sr;
        }

       // var amount = rate * qty;


        data = '';
        data += '<tr>';
        data += '<td hidden class ="Id">0</td>';
        data += '<td hidden class ="WareHouseId text-center">' + penaltyId + '</td>';
        data += '<td class ="WareHoseName text-left">' + penaltyName + '</td>';
        data += '<td hidden class ="LocationId text-center">' + locationId + '</td>';
        data += '<td class ="LocationName text-left">' + locationName + '</td>';
        data += '<td class ="Qty2 text-right">' + qty + '</td>';
        data += '<td class ="BalQty2 text-right">' + balQty + '</td>';
        data += '<td class="text-center">';
        data += '<a class="btn btn-sm btn-danger m-t-n-xs" onclick="deleterow2($(this));"> <i class="fa fa-trash" title="Delete"></i></a></td>';
        data += '</tr>';
        $('#tableSt tbody').append(data);

        $("#WareHouseId").focus();

        clearTextBox2();
        RowCalculation2();
    }
    function clearTextBox2() {
        $("#Rate").val("");
        $("#Qty").val("");
        $("#Amount").val("");
        var balQty = Number($("#balQty2").val());
        var measure2 = 0;

        //$('#tableSt > tbody > tr').each(function () {
        //    debugger;
            var TotalActual = Number($("#Qty2 ").val());
            measure2 = measure2 + TotalActual;

       // });

        var balbal = balQty - measure2;
        $("#balQty2").val(balbal.toFixed(2));

    }

    function CalculateAmount2() {

        var rate = Number($("#Rate").val());
        var qty = Number($("#Qty").val());
        var amount = rate * qty;

        $("#Amount").val(amount);
    }
    function RowCalculation2() {
        debugger

        var measure = 0;
        var actual = 0;

        $('#tableSt > tbody > tr').each(function () {
            debugger;

            var TotalMeasure = Number($(this).find(".Qty2 ").text());
            var TotalActual = Number($(this).find(".BalQty2 ").text());

            measure = measure + TotalMeasure;
            actual = actual + TotalActual;
        });
        $('#tableSt > tfoot > tr').find(".TotalMeasure").text(measure);
        $('#tableSt > tfoot > tr').find(".TotalActual").text(actual.toFixed(2));
        $("#BalanceQuantity").val(actual)
    }
    function deleterow2(row) {
        debugger
        var actual = Number(row.closest("tr").find(".Actual").text());
        var Qty2 = Number(row.closest("tr").find(".Qty2").text());
        var balQty = Number($("#balQty2").val());
        var balanceQuantity = Number($("#BalanceQuantity").val());
        $("#BalanceQuantity").val(balanceQuantity + actual);
        var balbal = Qty2 + balQty;
        $("#balQty2").val(balbal);
        row.closest("tr").remove();
        RowCalculation2();
    }


    $("#tableSt tbody").on("click", ".remove-row", function () {
        debugger;
        $(this).closest("tr").remove();
        RowCalculation2();
        //GetRowFooter2()

    });

    </script>
}