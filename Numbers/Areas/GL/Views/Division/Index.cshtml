@model DivisionVM
@{ ViewData["Title"] = "Division";
    ViewData["CurrentPage"] = "Division"; }


<style>
    .transparentInput {
        background-color: #e7eaec;
        color: black;
        border: none;
        outline: none;
        height: 30px;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <h5>@ViewBag.EntityState Department</h5>
                <span class="label label-success pull-right status"></span>
            </div>
            <div class="ibox-content ibox-content-1">

                <form class="" method="post" onsubmit="return check(this);">
                    <div class="row">
                        <input hidden asp-for="GLDivision.Id" />
                        <div class="col-md-3 col-lg-3">
                            <div class="form-group">
                                <label class="col-form-label">Name</label>
                                @if (Model.GLDivision.Id == 0)
                                {
                                    <input class="form-control" autofocus id="name" data-validation="required" asp-for="GLDivision.Name" /> }
                                else
                                {
                                    <input class="form-control" id="name" readonly data-validation="required" asp-for="GLDivision.Name" />}
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-4">
                            <div class="form-group">
                                <label> Date</label>
                                <div class="input-group date" autofocus>
                                    <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                    <input asp-for="GLDivision.Date" class="form-control" data-validation="required" type="text" value=@(Model.GLDivision.Id == 0 ? CommonHelper.CurrentDate : Model.GLDivision.Date.ToString(CommonHelper.DateFormat)) readonly tabindex="-1" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 col-lg-7">
                            <div class="form-group">
                                <label class="col-form-label">Description</label>
                                <input maxlength="50" class="form-control" data-validation="required" asp-for="GLDivision.Description" />
                            </div>
                        </div>
                        <div class="col-sm-1 col-sm-1">
                            <label>IsActive</label>
                            <input type="checkbox" class="checkbox" asp-for="GLDivision.IsActive" />
                        </div>
                        
                    </div>




                    <div class="ibox-title">
                        <h5>Sub Department</h5>
                        <span class="label label-success pull-right status"></span>
                    </div>

                    <div class="row">
                        <div class="col-lg-2">
                            <div class="form-group">
                                <label class="control-label">Name</label>
                                <div>
                                    @*<input class="form-control" id="accountmaintenanceGLAccount" />*@
                                    <input class="form-control" id="DetailName" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="form-group">
                                <label class="control-label">Description</label>
                                <div>
                                    <input class="form-control" id="DetailDescription" />
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-1">
                            <div class="form-group">
                                <a id="addbtn" class="btn btn-success" style="margin-top:22px;"><i class="fa fa-plus"></i> </a>
                            </div>
                        </div>
                    </div>
                    <div class="container-fluid table-responsive">
                        <table id="tblDetail" class="table table-bordered table-striped " >
                            <thead>
                                <tr>
                                    <th width="20%">
                                        Name
                                    </th>
                                    <th width="70%">
                                        Description
                                    </th>
                                    <th width="10%">
                                        Action
                                    </th>
                                </tr>
                            </thead>

                            <tbody>
                                @foreach (var item in Model.GLSubDivisionList)
                                {
                                    <tr>

                                        <td hidden> <input value="@item.Id" id="DetailId" name="DetailId" class="form-control" readonly /></td>

                                        <td> <input value="@item.Name" id="tblDetailName" name="DetailName" class="form-control transparentInput" readonly /></td>

                                        <td> <input value="@item.Description" id="DetailDescription" name="Description" class="form-control transparentInput" readonly /></td>

                                        <td>
                                            <a id="delrow" onclick="deleterow($(this));" class="btn btn-danger m-t-n-xs"> <i id="delrow" onclick="deleterow($(this));" class="fa fa-trash" title="Delete"></i> </a>
                                            <a id="editrow" onclick="editrow($(this));" class="btn btn-primary m-t-n-xs"> <i id="editrow" onclick="editrow($(this));" class="fa fa-edit" title="Edit"></i> </a>
                                            <a id="doneEdit" style="display:none;" onclick="doneEdit($(this));" class="btn btn-success m-t-n-xs"> <i id="doneEdit" onclick="doneEdit($(this));" class="fa fa-check" title="doneEdit"></i> </a>
                                        </td>

                                    </tr>
}
                            </tbody>
                        </table>
                    </div>
                    <div class="row" style="margin-top:10px;">
                        <div class="form-group">
                            <div class="col-lg-4 ">
                                <a value="List" class="btn btn-white" asp-controller="Division" asp-action="List">List</a>
                                <input type="submit" value="Save" class="btn btn-primary" asp-action="Create" asp-controller="Division" />

                            </div>
                        </div>
                    </div>

                    <input hidden id="detail" name="detail" />
                </form>



            </div>
        </div>
    </div>
</div>


@section CustomJS{
    <script src="\Numbers\wwwroot\lib\sweetalert"></script>
    <script src="~/lib/validate/jquery.validate.min.js"></script>
    <script src="~/js/notify.js"></script>
    <script>
        $(document).ready(function () {

            $.validate();
        });

        function check(form) {
            var name = $("#name").val();
            var chk = 0;
             var model = @Model.GLDivision.Id;
            if (model == 0) {
                $.ajax({
                    type: 'GET',
                    url: '/GL/Division/CheckName?name=' + name,
                    async: false,
                }).done(function (data) {
                    debugger;

                    if (data == true) {
                        chk = 1;

                    }

                });
            }
            debugger;
            if (chk == 1) {
                $.notify("Department Name already Exist", "error");

                return false;
            }
            else {
                return true;
            }


        }

        function checkdesc(form) {
            var name = $("#name").val();
            var chk = 0;
             var model = @Model.GLDivision.Id;
            if (model == 0) {
                $.ajax({
                    type: 'GET',
                    url: '/GL/Division/Checkdesc?name=' + name,
                    async: false,
                }).done(function (data) {
                    debugger;

                    if (data == true) {
                        chk = 1;

                    }

                });
            }
            debugger;
            if (chk == 1) {
                $.notify("Department Name already Exist", "error");

                return false;
            }
            else {
                return true;
            }
        }

        function deleterow(row) {
            row.closest("tr").remove();
        }

        function editrow(row) {

            row.closest("tr").find("#DetailDescription").attr("readonly", false);
            row.closest("tr").find("#doneEdit").show();
            row.closest("tr").find("#editrow").hide();

        }

        function doneEdit(row) {

            row.closest("tr").find("#DetailDescription").attr("readonly", true);
            row.closest("tr").find("#doneEdit").hide();
            row.closest("tr").find("#editrow").show();
        }

        $('#addbtn').click(function () {
            debugger;
            var DetailName = $("#DetailName").val();
            var DetailDescription = $("#DetailDescription").val();
            if (DetailName == "" || DetailDescription == "") {
                swal("", "Please Fill Name And Description", "warning")

            }
            else {
                debugger;
                var name = $("#DetailName").val();
                var desc = $("#DetailDescription").val();
                var value = false;
                var descvalue = false;
                $('#tblDetail > tbody > tr').each(function () {
                    //var check = $(this).closest("tr").find("#tblDetailCode").val();
                    var check = $(this).closest("tr").find("#tblDetailName").val();
                    var check2 = $(this).closest("tr").find("#DetailDescription").val();
                    debugger;
                    if (name == check) {
                        value = true;
                         
                    }
                    if (desc == check2) {
                        descvalue = true;
                    }

                });

                if (value == false) {
                    var items = '';
                    items += '<tr>';
                    items += '<td hidden> <input value="0" id="Id" name="DetailId" class="form-control Id" readonly /></td>';
                    items += '  <td> <input value="' + DetailName + '" id="tblDetailName" name="DetailName" class="form-control DetailName" readonly /></td>';
                    items += '<td> <input value="' + DetailDescription + '" id="DetailDescription" name="Description" class="form-control DetailDescription" readonly /></td>';
                    items += '<td> <a id="delrow" onclick="deleterow($(this));" class="btn btn-danger m-t-n-xs"> <i id="delrow" onclick="deleterow($(this));" class="fa fa-trash" title="Delete"></i> </a> </td>';
                    items += '</tr>';
                    $("#tblDetail").append(items);

                    $("#DetailDescription").val("");
                    $("#DetailName").val("");
                }
                else if (value == true) {
                    swal("", "Name already exists..", "warning")
                }
                else if (descvalue == true)
                {
                    swal("", "Description already exists..", "warning")
                }
               
            }
        });

        $("form").submit(function (e) {
            debugger
            debugger
            var length = $('#tblDetail > tbody').find('tr').length;
            if (length == 0) {
                swal("", "Sub Department must be enter.","warning");
                return false
            } else {
                //Model Binding of Items
                var Detail = [];
                $.each($("#tblDetail tbody tr"), function () {
                    Detail.push({
                        Id: $(this).closest("tr").find('td:eq(0) input').val(),
                        Name: $(this).closest("tr").find('td:eq(1) input').val(),
                        Description: $(this).closest("tr").find('td:eq(2) input').val(),
                    });
                });

                var model = JSON.stringify(Detail);
                $("#detail").val(model);
                return true;
            }

        });

    </script>





}







