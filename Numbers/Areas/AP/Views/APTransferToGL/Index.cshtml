@model IEnumerable<APLC>
@{ 
    ViewData["Title"] = "Transfer To GL";
}
<style>
    .nested-table {
        margin: auto;
        width: 80% !important;
    }

    .table-stripped > thead > tr > th {
        border: 1px solid #EBEBEB !important;
    }
</style>

<div class="row">
    <div class="col-lg-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title">
                <div class="row">
                    <div class="col-lg-9">
                        <h5>@ViewBag.NavbarHeading</h5>
                        <span class="label label-success pull-right status"></span>
                    </div>
                    <div class="col-lg-3">
                        <input class="form-control" id="Input" type="text" placeholder="Search..">
                    </div>
                </div>
                
            </div>
            <div class="ibox-content ibox-content-1">
                    <table class="table table-stripped table-hover main-table">
                        <thead>
                            <tr>
                                <th hidden></th>
                                <th width="3%"></th>
                                <th>LC #</th>
                                <th>LC Type</th>
                                <th>LC Date</th>
                                <th>Bank Name</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody id="Table">
                            @foreach (var LC in Model)
                            {
                                <tr onclick="slider($(this));" class="MasterTr">
                                    <td hidden>@LC.Id</td>
                                    <td><input type="checkbox" class="chk form-check-input" /></td>
                                    <td class="text-right">@LC.LCNo</td>
                                    <td>@LC.LCName</td>
                                    <td class="text-center">@(LC.LCOpenDate == null ? CommonHelper.CurrentDate : LC.LCOpenDate.ToString(CommonHelper.DateFormat))</td>
                                    <td>@LC.BankName</td>
                                    <td class="text-right">@LC.TotalAmount</td>
                                </tr>
                                <tr class="trSlider" style="display:none;">
                                    <td colspan="6">
                                        <div>
                                            <table class="table table-bordered nested-table">
                                                <thead>
                                                    <tr>
                                                        <th>GL Code</th>
                                                        <th>Account Name</th>
                                                        <th>Expence Amount</th>
                                                        <th>Expence Date</th>
                                                    </tr>
                                                </thead>
                                                <tbody class="nested-tbody">
                                                    @foreach (var detail in ViewBag.details)
                                                    {
                                                        if (detail.LCId == LC.Id)
                                                        {
                                                            <tr class="nested-td">
                                                                <td hidden>@detail.Id</td>
                                                                <td hidden>@detail.LCId</td>
                                                                <td>@detail.GLCode</td>
                                                                <td>@detail.AccountName</td>
                                                                <td>@detail.ExpenseAmount</td>
                                                                <td height="35px">@detail.ExpenseDate.ToString(CommonHelper.DateFormat)</td>
                                                            </tr>
                                                        }
                                                    }
                                                </tbody>
                                            </table>
                                        </div>
                                    </td>
                                </tr>
                            }

                        </tbody>
                    </table>
                    <a class="btn btn-primary" id="transfer">Transfer to GL</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#Input").on("keyup", function () {
                $('.trSlider').slideUp(1);
                var value = $(this).val().toLowerCase();
                $("#Table > .MasterTr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
        function slider(row) {
            debugger
            var b = row.closest("tr").index();
            $('.trSlider').eq(b / 2).toggle();
        }
        $("#transfer").click(function () {
            debugger
            var transferData = [];
            $(".main-table > tbody > tr").each(function () {

                var currentRow = $(this);
                var LCId = parseInt(currentRow.closest("tr").find("td:eq(0)").text());
                if (currentRow.find(".chk").is(":checked")) {
                    transferData.push(LCId);
                }
            });
            console.log(transferData);
            $.ajax({
                type: "post",
                url: "/AP/APTransferToGL/LCData",
                data: { LcIDs: transferData }
            });
        });
    </script>
}