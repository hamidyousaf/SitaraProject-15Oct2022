@model ARInvoiceViewModel
@{
    Layout = null;
}
<style>
    .select2-container--default .select2-selection--single .select2-selection__arrow {
        height: 0%;
        top: 39px;
    }
    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>
@if (ViewBag.InvoiceItems == null)
{
    <div id="sale-invoic" class="border border-danger">
        <div @*class="ibox"*@>
            <div class="ibox-title">
                <h5 class="font-bold">Add Invoice Items</h5>
            </div>
            <div class="ibox-content">
                <div class="row form-group">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-sm-12 col-md-6 col-lg-6 tooltest0" id="tooltest0">
                                <input asp-for="InvoiceItemId" type="hidden" name="InvoiceItemId" id=@string.Format("{0}{1}","InvoiceItemId",ViewBag.Counter) />
                                <label asp-for="ItemId"></label>
                                <select asp-for="ItemId" name="ItemId" id='@string.Format("{0}{1}", "ItemId", ViewBag.Counter)' onchange="getUOM(this.id)" class="form-control select-item" data-validation="required" data-validation-error-msg="Item is required" data-validation-error-msg-container=@string.Format("#_item{0}",ViewBag.Counter)>
                                    <option disabled selected>Select an item...</option>
                                </select>
                                <p id=@string.Format("_item{0}",ViewBag.Counter)></p>
                            </div>
                            <div class="col-lg-6">
                                <div class="col-sm-4 col-md-6 col-lg-6">
                                    <label asp-for="Qty" class="col-lg-6 col-sm-6"></label>
                                    <label asp-for="Stock" class="col-lg-4 col-sm-6"></label>
                                    <div class="input-group">
                                        <input asp-for="Qty" name="Qty" id=@string.Format("{0}{1}", "Qty_", ViewBag.Counter) class="form-control text-right dependent on-focus-change-color" onchange="calculateLineTotal(@ViewBag.Counter)" type="number" data-validation="required" data-validation-error-msg="Quantity is required" data-validation-error-msg-container=@string.Format("#_qty{0}",ViewBag.Counter) />
                                        <span name="UOM" class="input-group-addon @string.Format("{0}{1}", "UOM", ViewBag.Counter)" id=@string.Format("{0}{1}", "UOM", ViewBag.Counter)></span>
                                        <input asp-for="UOM" name="UOM" readonly class="input-group-addon @string.Format("{0}{1}", "UOM", ViewBag.Counter)" type="hidden" />
                                        <input asp-for="Stock" name="Stock" id=@string.Format("{0}{1}", "Stock_", ViewBag.Counter) readonly class="form-control text-right calculate-total" type="text" tabIndex="-1" />
                                    </div>
                                    <p id=@string.Format("_qty{0}",ViewBag.Counter)></p>
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-3">
                                    <label asp-for="Rate"></label>
                                    <input asp-for="Rate" name="Rate" id=@string.Format("{0}{1}", "Rate_", ViewBag.Counter) class="form-control text-right dependent on-focus-change-color" onchange="calculateLineTotal(@ViewBag.Counter)" type="number" data-validation="required" data-validation-error-msg="Rate is required" data-validation-error-msg-container=@string.Format("#_rate{0}",ViewBag.Counter) /> <p id=@string.Format("_rate{0}",ViewBag.Counter)></p>
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-3">
                                    <label asp-for="Total_"></label>
                                    <input asp-for="Total_" name="Total_" id=@string.Format("{0}{1}", "Total_", ViewBag.Counter) class="form-control text-right" readonly tabIndex="-1" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-lg-10">
                                <div class="col-sm-4 col-md-6 col-lg-3" style="margin-left: -14px;">
                                    <label asp-for="TaxSlab"></label>
                                    <select asp-for="TaxSlab" asp-items="@(new SelectList(Model.TaxList,"Id","Name"))" name="TaxSlab" id='@string.Format("{0}{1}", "TaxSlab_", ViewBag.Counter)' onchange="calculateTax(@ViewBag.Counter)" class="form-control calculate-total dependent" data-validation="required" data-validation-error-msg="Tax Slab is required" data-validation-error-msg-container=@string.Format("#_taxSlab{0}",ViewBag.Counter)>
                                        <option selected disabled>
                                            Select...
                                        </option>
                                    </select>
                                    <p id=@string.Format("_taxSlab{0}",ViewBag.Counter)></p>
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-1">
                                    <label asp-for="DiscountPercentage"></label>
                                    <input asp-for="DiscountPercentage" name="DiscountPercentage" id=@string.Format("{0}{1}", "DiscountPercentage_", ViewBag.Counter) class="form-control text-right dependent on-focus-change-color" onchange="calculateLineTotal(@ViewBag.Counter)" type="number" />
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-2">
                                    <label asp-for="DiscountAmount"></label>
                                    <input asp-for="DiscountAmount" name="DiscountAmount" id=@string.Format("{0}{1}", "DiscountAmount_", ViewBag.Counter) readonly class="form-control text-right calculate-total" tabIndex="-1" />
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-1">
                                    <label asp-for="SalesTaxPercentage"></label>
                                    <input asp-for="SalesTaxPercentage" name="SalesTaxPercentage" id=@string.Format("{0}{1}", "SalesTaxPercentage_", ViewBag.Counter) readonly class="form-control text-right calculate-total" value="" type="number" tabIndex="-1" />
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-2">
                                    <label asp-for="SalesTaxAmount"></label>
                                    <input asp-for="SalesTaxAmount" name="SalesTaxAmount" id=@string.Format("{0}{1}", "SalesTaxAmount_", ViewBag.Counter) readonly class="form-control text-right calculate-total" tabIndex="-1" />
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-1">
                                    <label asp-for="ExciseTaxPercentage"></label>
                                    <input asp-for="ExciseTaxPercentage" name="ExciseTaxPercentage" id=@string.Format("{0}{1}", "ExciseTaxPercentage_", ViewBag.Counter) readonly class="form-control text-right calculate-total" value="" type="number" tabIndex="-1" />
                                </div>
                                <div class="col-sm-4 col-md-6 col-lg-2">
                                    <label asp-for="ExciseTaxAmount"></label>
                                    <input asp-for="ExciseTaxAmount" name="ExciseTaxAmount" id=@string.Format("{0}{1}", "ExciseTaxAmount_", ViewBag.Counter) readonly class="form-control text-right calculate-total" tabIndex="-1" />
                                </div>
                                <div hidden class="col-sm-4 col-md-6 col-lg-2">
                                    <label hidden asp-for="IssueRate"></label>
                                    <input hidden asp-for="IssueRate" name="IssueRate" id=@string.Format("{0}{1}","IssueRate_",ViewBag.Counter) class="form-control text-right calculate-total" tabIndex="-1" />
                                </div>
                                <div hidden class="col-sm-4 col-md-6 col-lg-2">
                                    <label hidden asp-for="CostofSales"></label>
                                    <input hidden asp-for="CostofSales" name="CostofSales" id=@string.Format("{0}{1}","CostofSales_",ViewBag.Counter) readonly class="form-control text-right calculate-total" tabIndex="-1" />
                                </div>
                            </div>
                            <div class="col-sm-4 col-md-6 col-lg-2">
                                <label asp-for="LineTotal"></label>
                                <input asp-for="LineTotal" name="LineTotal" id=@string.Format("{0}{1}", "LineTotal_", ViewBag.Counter) readonly class="form-control text-right calculate-total" tabIndex="-1" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-md-6 col-lg-12">
                        <label asp-for="Remarks"></label>
                        <textarea asp-for="Remarks" rows="1" name="Remarks" id=@string.Format("{0}{1}", "Remarks", ViewBag.Counter) class="form-control on-focus-change-color"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>}
<p id="p"></p>
<div class="text-right mb-3">
    <a id="add-invoice-item" class="btn btn-success add-invoice-item"><i class="fa fa-plus"></i></a>
</div>

<!--Page level calculations like total amount after taxes and total taxes amount etc-->
<div class="ibox">
    <div class="ibox-content">
        <div class="row">
            <div class="col-lg-12">
                <div class="col-lg-2"> <label>Total:</label> <input asp-for="Total" name="Total" id="Total" class="form-control text-right" tabIndex="-1" readonly placeholder="Total" /></div>
                <div class="col-lg-2"><label>Total Discount:</label><input name="totalDiscountAmount" id="discountAmount" class="form-control text-right" tabIndex="-1" readonly placeholder="Discount Amount" /></div>
                <div class="col-lg-2"><label>Total Sales Tax:</label> <input name="totalSalesTaxAmount" id="salesTaxAmount" class="form-control text-right" tabIndex="-1" readonly placeholder="Sales Tax Amount" /></div>
                <div class="col-lg-2"><label>Total Excise Tax:</label><input name="totalExciseTaxAmount" id="exciseTaxAmount" class="form-control text-right" tabIndex="-1" readonly placeholder="Excise Tax Amount" /></div>
                <div class="col-lg-2"><label>Grand Total:</label> <input asp-for="GrandTotal" name="GrandTotal" id="GrandTotal" class="form-control text-right" tabIndex="-1" readonly placeholder="GrandTotal" /></div>
            </div>
        </div>
    </div>
</div>
<!--End of Page level calculations like total amount after taxes and total taxes amount etc-->

<input id="counter" type="hidden" value="@ViewBag.Counter" />
<script src="https://code.jquery.com/jquery-3.4.1.js"></script>
<script src="~/js/INV/customSelect2.js"></script>
<script>
$(document).ready(function () {
    _applySelect($('#ItemId' + ''+ @ViewBag.Counter + ''));
        var items = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.InvoiceItems));
        var counter = 1;
        if (items != null) {
            if (items.length == 0) {
                counter = counter;
            } else if (items.length != 0) {
                counter = items.length + 1;
            }
        }
        $('#add-invoice-item').on('click', function () {
            $.post("/AR/Invoice/PartialInvoiceItems", { counter: counter }).done(function (data) {
                $("#p").append(data);
                counter++;
            });
    });
    lockOutInputs(@ViewBag.Counter);
    });
</script>
